<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href = '/main.css' rel="stylesheet">
</head>
<body class="grey-bg">

    <%- include('nav.ejs') %>
    
    <form class="search-box" action="/search" method="POST"> 
        <input name="search_words" placeholder="ë‘ ê¸€ì ì´ìƒ ì…ë ¥">
        <button type="submit" style="cursor: pointer;">
            ê²€ìƒ‰
        </button>
    </form>

    <div class="white-bg">

        
        <% for(let i = 0; i < ê¸€ëª©ë¡.length; i++){ %>
            <div class="list-box">
                <h4>
                  <a href="/detail/<%= ê¸€ëª©ë¡[i]._id %>">
                    <%= ê¸€ëª©ë¡[i].title %>
                  </a>
                  <a href="/edit/<%= ê¸€ëª©ë¡[i]._id %>"> âœï¸ </a>
                  <span class="delete" data-id="<%= ê¸€ëª©ë¡[i]._id %>">ğŸ—‘ï¸</span>
                  <a href="/chat/<%= ê¸€ëª©ë¡[i]._id %>"> ì±„íŒ…í•˜ê¸° </a>
                </h4>
                <p><%= ê¸€ëª©ë¡[i].content.length > 80 ? ê¸€ëª©ë¡[i].content.slice(0, 80) + '...' : ê¸€ëª©ë¡[i].content %></p>
                <p>ì‘ì„±ì : <%= ê¸€ëª©ë¡[i].writer %></p>
                
            </div>
        <% } %>



        <div class="list-box" style="background: #eee;">
            <a href="/list/prev/<%= ê¸€ëª©ë¡[0]._id %>">ì´ì „</a>
            <a href="/list/next/<%= ê¸€ëª©ë¡[ê¸€ëª©ë¡.length-1]._id %>">ë‹¤ìŒ</a>
        </div>
    </div>
    
    

    <script>
       

    //form íƒœê·¸ë¡œ get postìš”ì²­ì„ í•˜ë©´ ìƒˆë¡œê³ ì¹¨ì´ ë¨
    // -> ajaxë¡œ deleteìš”ì²­ ì‹œ bodyê°€ ì˜ ì•ˆê°€ëŠ” ê²½ìš° ìˆìŒ 
    // -> querystring ì´ìš©
    for(let i = 0; i < '<%=ê¸€ëª©ë¡.length%>'; i++){
        document.querySelectorAll('.delete')[i].addEventListener('click', function(e){
        fetch('/delete?docid=' + e.target.dataset.id, {//e.targetì„ í™œìš©í•˜ì—¬ querystringìœ¼ë¡œ id ì „ì†¡
            method : 'DELETE'
        })//fetchì´í›„ì— ì‹¤í–‰ë  ì½”ë“œ
        .then((r)=>{
        if(r.status == 200){//ì„œë²„ê°€ ì„±ê³µ status ì „ì†¡ì‹œ
            return r.text() //ì„œë²„ê°€ ë³´ë‚¸ê²Œ textë©´ r.text(), Array,Objectë©´ r.Json ë°˜í™˜
           
        }else{
            //ì„œë²„ê°€ ì—ëŸ¬ì „ì†¡ì‹œ
            window.location.href = '/login';
        }})
        .then((result)=>{
            //ì„±ê³µì‹œ ì‹¤í–‰ì½”ë“œ 
            console.log(result)
            
        })
        .catch((error)=>{
            //ì¸í„°ë„·ë¬¸ì œ ë“±ìœ¼ë¡œ ì‹¤íŒ¨ì‹œ ì‹¤í–‰ì½”ë“œ
            console.log(error)
        })
        .then(()=>{
                e.target.parentElement.parentElement.style.display = 'none'//ì´ë¯¸ì§€ìƒìœ¼ë¡œ ìˆ¨ê²¨ì£¼ëŠ” ì½”ë“œ
            
        })
        
      })
    }

    // ì˜ˆì™¸ì²˜ë¦¬ í˜•ì‹
  
    

    </script>
    <!-- ì„œë²„ë¡œ ë°ì´í„°ë³´ë‚´ëŠ” ë‹¤ë¥¸ ë°©ë²• : 
    1. <form>  2. ajaxì´ìš©
    3. query string(ë³´ì•ˆì·¨ì•½)  4. URL parmeter(ë³´ì•ˆì·¨ì•½) -->

</body>
</html>
